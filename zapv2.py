import subprocess
import time

# Author: T1

def run_zap_scan(target_url):
    """
    Runs an automated penetration testing scan on the target URL using OWASP ZAP.
    """
    # Launch ZAP in daemon mode
    subprocess.Popen(['zap.sh', '-daemon'], stdout=subprocess.PIPE)

    # Wait for ZAP to start up
    time.sleep(10)

    # Run the ZAP spider and active scan
    subprocess.check_call(['zap-cli', '-p', '8090', 'spider', target_url])
    subprocess.check_call(['zap-cli', '-p', '8090', 'active-scan', target_url])

    # Generate the ZAP report
    report_file = f"{target_url.replace('https://', '').replace('http://', '')}.html"
    subprocess.check_call(['zap-cli', '-p', '8090', 'report', '-o', report_file, '-f', 'html'])

    print(f"ZAP scan complete. Report saved to {report_file}.")

if __name__ == '__main__':
    print("Welcome to AutoPenTest!")
    print("This script will run an automated penetration testing scan using OWASP ZAP.")
    print("Please enter the URL of the target to scan:")
    target_url = input("> ")
    run_zap_scan(target_url)
